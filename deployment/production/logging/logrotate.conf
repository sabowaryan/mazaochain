# Log rotation configuration for MazaoChain production
# This file should be placed in /etc/logrotate.d/mazaochain

/opt/mazaochain/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 mazaochain mazaochain
    sharedscripts
    postrotate
        # Restart the application to reopen log files
        /usr/bin/docker-compose -f /opt/mazaochain/deployment/production/docker-compose.yml restart mazaochain-app > /dev/null 2>&1 || true
        
        # Send HUP signal to nginx to reopen log files
        /usr/bin/docker-compose -f /opt/mazaochain/deployment/production/docker-compose.yml exec nginx nginx -s reopen > /dev/null 2>&1 || true
    endscript
}

/opt/mazaochain/logs/nginx/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 root root
    sharedscripts
    postrotate
        /usr/bin/docker-compose -f /opt/mazaochain/deployment/production/docker-compose.yml exec nginx nginx -s reopen > /dev/null 2>&1 || true
    endscript
}

/var/log/mazaochain/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 syslog adm
    sharedscripts
    postrotate
        systemctl reload rsyslog > /dev/null 2>&1 || true
    endscript
}